swagger: "2.0"
info:
  title: 幼儿园物联网项目API
  description: 幼儿园物联网项目API
  version: 1.0.0
  contact:
    email: happyjinyalei@163.com
basePath: /kindergarten
paths:
  /block/:
    post:
      tags:
      - block
      description: 添加区域
      operationId: BlockController.添加区域
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: 区域信息
        required: true
        schema:
          $ref: '#/definitions/models.BolckAddReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.Block'
        "500":
          description: 内部错误
  /block/{blockid}:
    delete:
      tags:
      - block
      description: 删除区域
      operationId: BlockController.删除区域
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: blockid
        description: 区域ID
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
        "404":
          description: 区域不存在
        "500":
          description: 内部错误
  /block/{blockid}/devices:
    get:
      tags:
      - block
      description: 查询区域的所有区域
      operationId: BlockController.查询的所有设备
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: blockid
        description: 区域ID
        required: true
        type: integer
        format: int64
      - in: query
        name: status
        description: 设备状态:-2 离线，-1 关，1 开,不上送返回所有状态
        type: integer
        format: int64
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.DevsRes'
        "404":
          description: 区域不存在
        "500":
          description: 内部错误
  /blockuser/:
    post:
      tags:
      - blockuser
      description: 添加区域
      operationId: BlockUserController.添加区域
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: 区域用户关系
        required: true
        schema:
          $ref: '#/definitions/models.BlockUser'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.BlockUser'
        "500":
          description: 内部错误
  /device/:
    post:
      tags:
      - device
      description: 添加设备类型
      operationId: DeviceController.添加设备类型
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: 设备类型信息
        required: true
        schema:
          $ref: '#/definitions/models.DevAddReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.Device'
        "500":
          description: 内部错误
  /device/{devid}:
    delete:
      tags:
      - device
      description: 删除设备类型
      operationId: DeviceController.删除设备类型
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: devid
        description: 设备ID
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
        "404":
          description: 设备不存在
        "500":
          description: 内部错误
  /device/turnonoff:
    post:
      tags:
      - device
      description: 批量打开/关闭设备
      operationId: DeviceController.批量打开/关闭设备
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: 要打开/关闭的设备，可只上送设备ID
        required: true
        schema:
          $ref: '#/definitions/models.Devices'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.Devices'
        "500":
          description: 内部错误
  /devtype/:
    post:
      tags:
      - devtype
      description: 添加设备类型
      operationId: DevTypeController.添加设备类型
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: 设备类型信息
        required: true
        schema:
          $ref: '#/definitions/models.DevTypeAddReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.DevType'
        "500":
          description: 内部错误
  /devtype/{devtypeid}:
    delete:
      tags:
      - devtype
      description: 删除设备类型
      operationId: DevTypeController.删除设备类型
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: devtypeid
        description: 设备类型ID
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
        "404":
          description: 设备类型不存在
        "500":
          description: 内部错误
  /devtype/all:
    get:
      tags:
      - devtype
      description: 查询所有设备类型
      operationId: DevTypeController.查询设备类型
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.DevTypesRes'
        "500":
          description: 内部错误
  /kg/:
    put:
      tags:
      - kg
      description: 修改园区
      operationId: KgController.修改园区
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: 园区名称
        required: true
        schema:
          $ref: '#/definitions/models.KgAddReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.KgRes'
        "409":
          description: 园区名已被使用
        "500":
          description: 内部错误
    post:
      tags:
      - kg
      description: 添加园区
      operationId: KgController.添加园区
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: 园区名称
        required: true
        schema:
          $ref: '#/definitions/models.KgAddReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.Kindergarten'
        "409":
          description: 园区名已被使用
        "500":
          description: 内部错误
  /kg/{kgid}:
    delete:
      tags:
      - kg
      description: 删除园区
      operationId: KgController.删除园区
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: kgid
        description: 园区ID
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
        "404":
          description: 园区不存在
        "500":
          description: 内部错误
  /kg/{kgid}/blocks:
    get:
      tags:
      - kg
      description: 查询园区的所有区域
      operationId: KgController.查询园区的所有区域
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: kgid
        description: 园区ID
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.BlocksRes'
        "404":
          description: 园区不存在
        "500":
          description: 内部错误
  /kg/{kgid}/devices:
    get:
      tags:
      - kg
      description: 查询园区的所有区域
      operationId: KgController.查询园区的所有设备
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: kgid
        description: 园区ID
        required: true
        type: integer
        format: int64
      - in: query
        name: status
        description: 设备状态:-2 离线，-1 关，1 开,不上送返回所有状态
        type: integer
        format: int64
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.DevsRes'
        "404":
          description: 园区不存在
        "500":
          description: 内部错误
  /kg/all:
    get:
      tags:
      - kg
      description: 获取所有园区
      operationId: KgController.获取所有园区
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.KgsRes'
        "500":
          description: 内部错误
  /kg/kgname/{name}:
    get:
      tags:
      - kg
      description: 以园区名为条件查询园区
      operationId: KgController.查询园区
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: path
        name: name
        description: 园区名称
        required: true
        type: string
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.Kindergarten'
        "404":
          description: 园区不存在
        "500":
          description: 内部错误
  /session/:
    post:
      tags:
      - session
      description: 用户登录
      operationId: SessionController.用户登录
      parameters:
      - in: body
        name: body
        description: 手机号和密码
        required: true
        schema:
          $ref: '#/definitions/models.LoginReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.LoginRes'
        "404":
          description: 用户不存在
        "500":
          description: 内部错误
    delete:
      tags:
      - session
      description: 用户退出登录
      operationId: SessionController.用户退出登录
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
        "403":
          description: userid或token为空
        "500":
          description: 内部错误
  /transmit/:
    post:
      tags:
      - transmit
      description: 给设备转发命令
      operationId: TransmitController.给设备转发命令
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      - in: body
        name: body
        description: "true"
        schema:
          $ref: '#/definitions/mqtt.TransmitContent'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.Devices'
        "500":
          description: 内部错误
  /user/:
    put:
      tags:
      - user
      description: 用户修改信息
      operationId: UserController.用户修改信息
      parameters:
      - in: body
        name: body
        description: 新的用户信息
        required: true
        schema:
          $ref: '#/definitions/models.ModifyUserReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.ModifyUserRes'
        "404":
          description: 用户不存在
        "409":
          description: 手机号已被使用
        "500":
          description: 内部错误
    post:
      tags:
      - user
      description: 用户注册
      operationId: UserController.用户注册
      parameters:
      - in: body
        name: body
        description: 手机号和密码
        required: true
        schema:
          $ref: '#/definitions/models.RegReq'
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.RegRes'
        "409":
          description: 手机号已被使用
        "500":
          description: 内部错误
  /user/device/statistic:
    get:
      tags:
      - user
      description: 获取登录用户权限下设备类型、状态统计
      operationId: UserController.获取登录用户权限下设备类型、状态统计
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.DevStatRes'
        "500":
          description: 内部错误
  /user/kgs:
    get:
      tags:
      - user
      description: 获取登录用户所在园区
      operationId: UserController.获取登录用户所在园区
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: integer
        format: int64
      responses:
        "200":
          description: ""
          schema:
            $ref: '#/definitions/models.KgsRes'
        "500":
          description: 内部错误
  /user/passwd:
    put:
      tags:
      - user
      description: 用户修改密码
      operationId: UserController.用户修改密码
      parameters:
      - in: header
        name: token
        description: 会话token
        required: true
        type: string
      - in: header
        name: userid
        description: 会话userid
        required: true
        type: string
      - in: body
        name: body
        description: 新密码和旧密码
        required: true
        schema:
          $ref: '#/definitions/models.ModifyPasswdReq'
      responses:
        "200":
          description: ""
        "403":
          description: 原密码错误
        "404":
          description: 用户不存在
        "500":
          description: 内部错误
definitions:
  models.Block:
    title: Block
    type: object
    properties:
      BlockID:
        type: integer
        format: int64
      BlockName:
        type: string
      KgID:
        type: integer
        format: int64
  models.BlockUser:
    title: BlockUser
    type: object
    properties:
      BlockID:
        type: integer
        format: int64
      UserID:
        type: integer
        format: int64
  models.BlocksRes:
    title: BlocksRes
    type: object
    properties:
      Blocks:
        type: array
        items:
          $ref: '#/definitions/models.Block'
      Num:
        type: integer
        format: int64
  models.BolckAddReq:
    title: BolckAddReq
    type: object
    properties:
      BlockName:
        type: string
      KgID:
        type: integer
        format: int64
  models.DevAddReq:
    title: DevAddReq
    type: object
    properties:
      BlockID:
        type: integer
        format: int64
      DevName:
        type: string
      DevTypeID:
        type: integer
        format: int64
  models.DevStat:
    title: DevStat
    type: object
    properties:
      AirConditionerOn:
        type: integer
        format: int64
      KgID:
        type: integer
        format: int64
      KgName:
        type: string
      LightOn:
        type: integer
        format: int64
  models.DevStatRes:
    title: DevStatRes
    type: object
    properties:
      DevStats:
        type: array
        items:
          $ref: '#/definitions/models.DevStat'
      Num:
        type: integer
        format: int64
  models.DevType:
    title: DevType
    type: object
    properties:
      DevTypeID:
        type: integer
        format: int64
      DevTypeName:
        type: string
  models.DevTypeAddReq:
    title: DevTypeAddReq
    type: object
    properties:
      DevTypeName:
        type: string
  models.DevTypesRes:
    title: DevTypesRes
    type: object
    properties:
      DevTypes:
        type: array
        items:
          $ref: '#/definitions/models.DevType'
      Num:
        type: integer
        format: int64
  models.Device:
    title: Device
    type: object
    properties:
      BlockID:
        type: integer
        format: int64
      BlockName:
        type: string
      DevID:
        type: integer
        format: int64
      DevName:
        type: string
      DevTypeID:
        type: integer
        format: int64
      Status:
        type: integer
        format: int64
  models.Devices:
    title: Devices
    type: object
    properties:
      Devs:
        type: array
        items:
          $ref: '#/definitions/models.Device'
  models.DevsRes:
    title: DevsRes
    type: object
    properties:
      Devices:
        type: array
        items:
          $ref: '#/definitions/models.Device'
      Num:
        type: integer
        format: int64
  models.KgAddReq:
    title: KgAddReq
    type: object
    properties:
      KgName:
        type: string
  models.KgRes:
    title: KgRes
    type: object
  models.KgsRes:
    title: KgsRes
    type: object
    properties:
      Kgs:
        type: array
        items:
          $ref: '#/definitions/models.Kindergarten'
      Num:
        type: integer
        format: int64
  models.Kindergarten:
    title: Kindergarten
    type: object
    properties:
      KgID:
        type: integer
        format: int64
      KgName:
        type: string
  models.LoginReq:
    title: LoginReq
    type: object
    properties:
      CellNum:
        type: string
      Password:
        type: string
  models.LoginRes:
    title: LoginRes
    type: object
    properties:
      Token:
        type: string
      UserID:
        type: integer
        format: int64
      UserName:
        type: string
  models.ModifyPasswdReq:
    title: ModifyPasswdReq
    type: object
    properties:
      NewPasswd:
        type: string
      OldPasswd:
        type: string
  models.ModifyUserReq:
    title: ModifyUserReq
    type: object
    properties:
      NewCellNum:
        type: string
      NewUserName:
        type: string
  models.ModifyUserRes:
    title: ModifyUserRes
    type: object
    properties:
      CellNum:
        type: string
      UserID:
        type: integer
        format: int64
      UserName:
        type: string
  models.RegReq:
    title: RegReq
    type: object
    properties:
      CellNum:
        type: string
      Password:
        type: string
      UserName:
        type: string
  models.RegRes:
    title: RegRes
    type: object
    properties:
      CellNum:
        type: string
      Token:
        type: string
      UserID:
        type: integer
        format: int64
      UserName:
        type: string
  mqtt.TransmitContent:
    title: TransmitContent
    type: object
    properties:
      Content:
        type: string
      DevID:
        type: integer
        format: int64
